<!DOCTYPE html>
<html>
<head>
    <title>Dining Philosophers Simulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 30px;
        }
        #circle {
            position: relative;
            width: 500px;
            height: 500px;
            margin: 50px auto;
            border: 2px dashed #ccc;
            border-radius: 50%;
        }
        .philosopher {
            position: absolute;
            width: 100px;
            height: 100px;
            border: 2px solid #ccc;
            border-radius: 50%;
            line-height: 100px;
            background-color: #e0e0e0;
            transition: background-color 0.3s;
        }
        .thinking {
            background-color: #e0e0e0;
        }
        .eating {
            background-color: #ffeb3b;
        }
        .fork {
            position: absolute;
            width: 20px;
            height: 80px;
            background-color: #ccc;
            transform-origin: center;
            transition: background-color 0.3s;
        }
        .fork.available {
            background-color: #8bc34a;
        }
        .fork.unavailable {
            background-color: #f44336;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Dining Philosophers Simulation üçù</h1>

    <!-- Input Section -->
    <div>
        <label for="numPhilosophers">Number of Philosophers:</label>
        <input type="number" id="numPhilosophers" value="5" min="2" max="10">
        <label for="speed">Simulation Speed (ms):</label>
        <input type="number" id="speed" value="1000" min="500">
        <button onclick="startSimulation()">Start Simulation</button>
        <button onclick="stopSimulation()">Stop Simulation</button>
    </div>

    <!-- Circular Display Area -->
    <div id="circle"></div>

    <script>
        let philosophers = [];
        let forks = [];
        let stopFlag = false;
        let numPhilosophers = 5;
        let simulationSpeed = 1000;
        const circleRadius = 200;

        // Delay simulation with async sleep
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Create philosophers and forks in a circular layout
        function setupUI() {
            const circle = document.getElementById('circle');
            circle.innerHTML = '';
            const angleStep = (2 * Math.PI) / numPhilosophers;

            philosophers = [];
            forks = [];
            
            for (let i = 0; i < numPhilosophers; i++) {
                // Philosopher Element
                const angle = i * angleStep;
                const philosopherDiv = document.createElement('div');
                philosopherDiv.className = 'philosopher thinking';
                philosopherDiv.id = `philosopher-${i}`;
                philosopherDiv.innerHTML = `üß† ${i}`;
                philosopherDiv.style.left = `${250 + circleRadius * Math.cos(angle) - 50}px`;
                philosopherDiv.style.top = `${250 + circleRadius * Math.sin(angle) - 50}px`;
                circle.appendChild(philosopherDiv);
                philosophers.push(philosopherDiv);

                // Fork Element
                const forkAngle = angle + angleStep / 2;
                const forkDiv = document.createElement('div');
                forkDiv.className = 'fork available';
                forkDiv.id = `fork-${i}`;
                forkDiv.style.left = `${250 + (circleRadius - 30) * Math.cos(forkAngle) - 10}px`;
                forkDiv.style.top = `${250 + (circleRadius - 30) * Math.sin(forkAngle) - 40}px`;
                forkDiv.style.transform = `rotate(${(forkAngle * 180) / Math.PI}deg)`;
                circle.appendChild(forkDiv);
                forks.push(true);
            }
        }

        // Update philosopher status
        function updatePhilosopherStatus(index, status) {
            const philosopherDiv = philosophers[index];
            if (status === 'thinking') {
                philosopherDiv.className = 'philosopher thinking';
                philosopherDiv.innerHTML = `üß† ${index}`;
            } else if (status === 'eating') {
                philosopherDiv.className = 'philosopher eating';
                philosopherDiv.innerHTML = `üçù ${index}`;
            }
        }

        // Update fork status
        function updateForkStatus(index, available) {
            const forkDiv = document.getElementById(`fork-${index}`);
            if (available) {
                forkDiv.className = 'fork available';
            } else {
                forkDiv.className = 'fork unavailable';
            }
        }

        // Acquire a fork
        async function acquireFork(index) {
            while (!forks[index]) {
                await sleep(100);
            }
            forks[index] = false;
            updateForkStatus(index, false);
        }

        // Release a fork
        function releaseFork(index) {
            forks[index] = true;
            updateForkStatus(index, true);
        }

        // Philosopher behavior
        async function philosopher(index) {
            while (!stopFlag) {
                updatePhilosopherStatus(index, 'thinking');
                await sleep(Math.random() * simulationSpeed);

                const leftFork = index;
                const rightFork = (index + 1) % numPhilosophers;

                // Try to acquire both forks
                await acquireFork(leftFork);
                await acquireFork(rightFork);

                updatePhilosopherStatus(index, 'eating');
                await sleep(Math.random() * simulationSpeed);

                // Release both forks
                releaseFork(leftFork);
                releaseFork(rightFork);
            }
        }

        // Start the simulation
        function startSimulation() {
            stopSimulation(); // Stop if running

            numPhilosophers = parseInt(document.getElementById('numPhilosophers').value);
            simulationSpeed = parseInt(document.getElementById('speed').value);
            forks = Array(numPhilosophers).fill(true);
            stopFlag = false;

            setupUI();

            for (let i = 0; i < numPhilosophers; i++) {
                philosopher(i);
            }
        }

        // Stop the simulation
        function stopSimulation() {
            stopFlag = true;
            document.getElementById('circle').innerHTML = '';
        }
    </script>
</body>
</html>
